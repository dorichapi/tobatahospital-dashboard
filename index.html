function doGet() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = sheet.getDataRange().getValues();

  var result = [];
  var headers = data[0];
  var today = new Date();
  today.setHours(0, 0, 0, 0);

  for (var i = 1; i < data.length; i++) {
    var row = {};
    var rowDate = new Date(data[i][0]); // 1列目の日付を取得
    rowDate.setHours(0, 0, 0, 0);

    // 30日分のデータを取得
    if ((today - rowDate) / (1000 * 60 * 60 * 24) <= 30) {
      for (var j = 0; j < headers.length; j++) {
        row[headers[j]] = data[i][j];
      }
      result.push(row);
    }
  }

  // **最終入力時刻を取得**
  var lastRow = sheet.getLastRow();
  var lastEditTime = new Date(sheet.getRange(lastRow, 1).getValue());

  return ContentService.createTextOutput(JSON.stringify({ data: result, lastEditTime: lastEditTime.toISOString() }))
    .setMimeType(ContentService.MimeType.JSON);
}
